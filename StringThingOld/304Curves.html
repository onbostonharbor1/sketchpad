<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Interactive Parametric Curves</title>
    <style>
      canvas { border: 1px solid #ccc; display: block; margin-bottom: 10px; }
      .control { margin-bottom: 10px; }
      textarea { width: 100%; height: 40px; }
    </style>
  </head>
  <body>
<canvas id="canvas" width="600" height="600"></canvas>
<div class="control">
  <label for="curveType">Curve type:</label>
  <select id="curveType">
    <option value="rose">Rose Curve</option>
    <option value="lissajous">Lissajous Curve</option>
    <option value="customCartesian">Custom Cartesian</option>
    <option value="customRadial">Custom Radial</option>
  </select>
</div>
<!-- Rose Controls -->
<div id="roseControls" class="control">
  <label>Rose Amplitude (a): <span id="roseAVal">100</span></label><br>
  <input type="range" id="roseA" min="50" max="200" value="100">
</div>
<!-- Lissajous Controls -->
<div id="lissajousControls" class="control" style="display:none;">
  <label>Lissajous A: <span id="lissAVal">100</span></label>
  <input type="range" id="lissA" min="50" max="200" value="100"><br>
  <label>Lissajous B: <span id="lissBVal">100</span></label>
  <input type="range" id="lissB" min="50" max="200" value="100"><br>
  <label>Lissajous a: <span id="lissAFreqVal">3</span></label>
  <input type="range" id="lissAfreq" min="1" max="10" value="3"><br>
  <label>Lissajous b: <span id="lissBFreqVal">2</span></label>
  <input type="range" id="lissBfreq" min="1" max="10" value="2"><br>
  <label>Delta: <span id="lissDeltaVal">1.57</span></label>
  <input type="range" id="lissDelta" min="0" max="6.28" step="0.01" value="1.57">
</div>
<!-- Custom Cartesian Controls -->
<div id="customCartesianControls" class="control" style="display:none;">
  <label>x(θ) = </label>
  <textarea id="customX">100*Math.cos(3*theta)</textarea><br>
  <label>y(θ) = </label>
  <textarea id="customY">100*Math.sin(2*theta)</textarea>
</div>
<!-- Custom Radial Controls -->
<div id="customRadialControls" class="control" style="display:none;">
  <label>r(θ) = </label>
  <textarea id="customR">100*Math.cos(2*theta)</textarea><br>
  <label>Angle offset (rad) = </label>
  <input type="number" id="radialOffset" value="0" step="0.01">
</div>
<!-- Steps -->
<div class="control">
  <label for="steps">Steps: <span id="stepsVal">2000</span></label><br>
  <input type="range" id="steps" min="500" max="4000" value="2000">
</div>
<script>
  // Canvas setup
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const canvasSize = canvas.width;
  // Generic parametric functions
  function roseCurve(theta, a) {
      const r = a * Math.cos(2*theta);
      return {x: r*Math.cos(theta), y: r*Math.sin(theta)};
  }
  function lissajous(theta, config) {
      const {A,B,a,b,delta} = config;
      return {x: A*Math.sin(a*theta+delta), y: B*Math.sin(b*theta)};
  }
  // Generate points
  function generateParametricPoints(paramFunc, steps, thetaMax){
      const points = [];
      for(let i=0;i<steps;i++){
          const theta = thetaMax*i/steps;
          points.push({...paramFunc(theta), theta});
      }
      return points;
  }
  // Intersections
  function findIntersections(points,tol=1e-6){
      const intersections=[];
      for(let i=0;i<points.length;i++){
          for(let j=i+1;j<points.length;j++){
              const dx = points[i].x - points[j].x;
              const dy = points[i].y - points[j].y;
              if(Math.abs(dx)<tol && Math.abs(dy)<tol){
                  intersections.push({x: points[i].x, y: points[i].y});
              }
          }
      }
      const unique=[];
      const seen=new Set();
      intersections.forEach(p=>{
          const key = `${p.x.toFixed(6)},${p.y.toFixed(6)}`;
          if(!seen.has(key)){seen.add(key); unique.push(p);}
      });
      return unique;
  }
  // Draw
  function drawCurve(curveType, config){
      ctx.clearRect(0,0,canvasSize,canvasSize);
      const cx = canvasSize/2, cy = canvasSize/2;
      let points;
      switch(curveType) {
      case 'rose':
          points = generateParametricPoints(theta => roseCurve(theta, config.a), config.steps, 2*Math.PI);
          break;
      case 'lissajous':
          points = generateParametricPoints(theta => lissajous(theta, config), config.steps, 2*Math.PI);
          break;
      case 'customCartesian':
          const xStr = document.getElementById('customX').value;
          const yStr = document.getElementById('customY').value;
          try {
              const paramFunc = new Function('theta', `return {x: ${xStr}, y: ${yStr}};`);
              points = generateParametricPoints(theta => paramFunc(theta), config.steps, 2*Math.PI);
          } catch(e) { alert('Error in custom Cartesian equations'); return; }
          break;
      case 'customRadial':
          const rStr = document.getElementById('customR').value;
          const offset = parseFloat(document.getElementById('radialOffset').value);
          try {
              const paramFunc = new Function('theta', `return ${rStr};`);
              points = generateParametricPoints(theta => {
                  const r = paramFunc(theta);
                  return { x: r * Math.cos(theta + offset), y: r * Math.sin(theta + offset) };
              }, config.steps, 2*Math.PI);
          } catch(e) { alert('Error in custom Radial equation'); return; }
          break;
      }
      // Draw curve
      ctx.beginPath();
      points.forEach((p,i)=>{
          const x = cx + p.x, y = cy - p.y;
          if(i===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
      });
      ctx.strokeStyle='blue';
      ctx.lineWidth=2;
      ctx.stroke();
      // Draw intersections
      const intersections = findIntersections(points);
      intersections.forEach(p=>{
          const x = cx + p.x, y = cy - p.y;
          ctx.beginPath();
          ctx.arc(x, y, 5, 0, 2*Math.PI);
          ctx.fillStyle = 'red';
          ctx.fill();
      });
  }
  // Initial config
  const drawConfig = {a:100,A:100,B:100,a:3,b:2,delta:Math.PI/2, steps:2000};
  // UI elements
  const curveSelect = document.getElementById('curveType');
  const roseControls = document.getElementById('roseControls');
  const lissajousControls = document.getElementById('lissajousControls');
  const customCartesianControls = document.getElementById('customCartesianControls');
  const customRadialControls = document.getElementById('customRadialControls');
  const roseA = document.getElementById('roseA');
  const roseAVal = document.getElementById('roseAVal');
  const stepsSlider = document.getElementById('steps');
  const stepsVal = document.getElementById('stepsVal');
  // Update draw
  function updateDraw(){
      const type = curveSelect.value;
      drawConfig.a = parseFloat(roseA.value);
      roseAVal.textContent = drawConfig.a;
      drawConfig.A = parseFloat(document.getElementById('lissA').value);
      drawConfig.B = parseFloat(document.getElementById('lissB').value);
      drawConfig.a = parseInt(document.getElementById('lissAfreq').value);
      drawConfig.b = parseInt(document.getElementById('lissBfreq').value);
      drawConfig.delta = parseFloat(document.getElementById('lissDelta').value);
      drawConfig.steps = parseInt(stepsSlider.value);
      stepsVal.textContent = drawConfig.steps;
      drawCurve(type, drawConfig);
  }
  // Toggle UI based on curve type
  curveSelect.addEventListener('change', ()=>{
      const type = curveSelect.value;
      roseControls.style.display = type==='rose'?'block':'none';
      lissajousControls.style.display = type==='lissajous'?'block':'none';
      customCartesianControls.style.display = type==='customCartesian'?'block':'none';
      customRadialControls.style.display = type==='customRadial'?'block':'none';
      updateDraw();
  });
  // Input listeners
  [
      roseA, stepsSlider,
      document.getElementById('lissA'), document.getElementById('lissB'),
      document.getElementById('lissAfreq'), document.getElementById('lissBfreq'),
      document.getElementById('lissDelta'),
      document.getElementById('customX'), document.getElementById('customY'),
      document.getElementById('customR'), document.getElementById('radialOffset')
  ].forEach(el => el.addEventListener('input', updateDraw));
  // Initial draw
  updateDraw();
</script>
  </body>
</html>
